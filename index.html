<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××¢×¨×›×ª × ×™×”×•×œ ×œ×™××•×“×™× ××ª×§×“××ª PRO - Ultimate Plus</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #4CAF50;
      --background-color: #f0f8ff;
      --error-color: #d32f2f;
      --success-color: #388e3c;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
      --dark-bg: #1e1e1e;
      --dark-text: #f5f5f5;
      --transition-speed: 0.3s;
    }
    /* Global Reset & Typography */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: var(--background-color); color: var(--primary-color); line-height: 1.6; transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; min-height: 100vh; direction: rtl; }
    body.dark-mode { background-color: var(--dark-bg); color: var(--dark-text); }
    /* Button Styles */
    button { background: linear-gradient(45deg, var(--secondary-color), #45a049); color: #fff; border: none; border-radius: 25px; padding: 10px 20px; font-weight: 500; text-transform: uppercase; transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; }
    button:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
    button:focus { outline: 2px solid var(--secondary-color); }
    /* Input, Select & Textarea Styles */
    input, select, textarea { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: border-color var(--transition-speed) ease; width: 100%; margin-bottom: 10px; }
    input:focus, select:focus, textarea:focus { border-color: var(--secondary-color); outline: none; }
    /* Authentication Container */
    .auth-container { max-width: 400px; margin: 3rem auto; padding: 2rem; background: #fff; border-radius: 15px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); text-align: center; }
    /* Dashboard Layout */
    .dashboard { display: none; min-height: 100vh; display: flex; flex-direction: row; }
    .sidebar { width: 250px; background: rgba(255,255,255,0.95); border-right: 1px solid #ddd; padding: 20px; box-shadow: 2px 0 12px rgba(0,0,0,0.05); }
    .sidebar h2 { margin-bottom: 20px; font-size: 1.4em; text-align: center; }
    .sidebar button { width: 100%; margin: 8px 0; padding: 12px; font-size: 1em; border-radius: 25px; }
    .sidebar img { display: block; margin: 0 auto 10px; }
    .main-content { flex: 1; padding: 30px; background: rgba(255,255,255,0.98); }
    header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
    header h1 { font-size: 1.8em; }
    header #clock { font-size: 1.2em; font-weight: 700; }
    header .controls button { margin-left: 10px; padding: 8px 12px; font-size: 0.9em; border-radius: 25px; background: var(--secondary-color); color: #fff; border: none; }
    header .controls button:hover { background: #45a049; }
    /* Card Component */
    .card { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 6px 12px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.2s ease; }
    .card:hover { transform: translateY(-3px); }
    /* Weather Section */
    .weather-section select { width: 100%; margin-bottom: 15px; }
    /* Schedule & Calendar Styles */
    #progress-container { width: 100%; background: #ddd; border-radius: 10px; margin: 15px 0; overflow: hidden; }
    #progress-bar { height: 20px; background: var(--secondary-color); width: 0%; transition: width 0.5s; }
    .calendar-view { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin: 20px 0; }
    .calendar-view div { padding: 10px; text-align: center; border-radius: 5px; cursor: pointer; transition: background 0.3s ease; border: 1px solid #ddd; }
    .calendar-view div:hover { background: #e8f5e9; }
    /* Day & Subject Cards */
    .day-container { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    .subject-card { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; background: #e8f5e9; padding: 8px 15px; margin: 8px 0; border-radius: 20px; cursor: grab; transition: transform 0.2s ease, background 0.2s ease; }
    .subject-card:hover { background: #c8e6c9; transform: scale(1.02); }
    .subject-card.completed { text-decoration: line-through; opacity: 0.6; }
    .subject-card span, .subject-card button { margin-right: 5px; }
    .remove-btn { cursor: pointer; color: var(--error-color); font-weight: bold; }
    /* School Hours System */
    .school-hours { margin-top: 20px; }
    .school-hours table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    .school-hours th, .school-hours td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    .school-hours th { background: var(--secondary-color); color: #fff; }
    .school-hours td .delete-hour { background: transparent; border: none; color: var(--error-color); font-weight: bold; cursor: pointer; }
    .school-hours .form-group { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .school-hours .form-group select, .school-hours .form-group input { flex: 1; }
    /* Export Options */
    .export-options { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; }
    .export-options button, .export-options select { padding: 10px; border-radius: 25px; background: var(--secondary-color); color: #fff; border: none; }
    .export-options button:hover, .export-options select:hover { background: #45a049; }
    .export-options select { background: #fff; color: var(--primary-color); border: 1px solid #ddd; }
    /* Modal & Overlay Styles */
    .modal, .settings-modal, .profile-modal, .help-modal, .feedback-modal, .dashboard-customization-modal {
      display: none; position: fixed; background: #fff; padding: 1.5rem; border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); z-index: 1100; max-width: 300px; text-align: center;
    }
    .modal, .profile-modal, .help-modal, .feedback-modal, .dashboard-customization-modal { top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .settings-modal { top: 50%; right: 20px; transform: translateY(-50%); }
    .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
    /* Notifications */
    .message { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; font-weight: bold; z-index: 1200; }
    .message.error { background: #ffebee; color: var(--error-color); }
    .message.success { background: #e8f5e9; color: var(--success-color); }
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .dashboard { flex-direction: column; }
      .sidebar { width: 100%; display: flex; overflow-x: auto; }
      .sidebar button { flex: 1; margin: 5px; }
    }
    /* Dark Mode Adjustments */
    body.dark-mode .card, body.dark-mode .sidebar, body.dark-mode .main-content, body.dark-mode .day-container { background: rgba(30,30,30,0.9); color: var(--dark-text); }
    body.dark-mode .subject-card { background: #444; }
    body.dark-mode input, body.dark-mode select, body.dark-mode textarea { background: #333; color: var(--dark-text); border: 1px solid #555; }
  </style>
</head>
<body>
  <!-- Authentication Container -->
  <div class="auth-container" id="auth-container">
    <h1 id="auth-heading">ğŸ“ ××¢×¨×›×ª × ×™×”×•×œ ×œ×™××•×“×™× ××ª×§×“××ª PRO</h1>
    <div id="login-or-register">
      <button id="btn-new-registration" onclick="showAuthForm('register')">ğŸ“ ×”×¨×©××” ×—×“×©×”</button>
      <button id="btn-login" onclick="showAuthForm('login')">ğŸ”‘ ×”×ª×—×‘×¨×•×ª</button>
    </div>
    <div id="register-form" style="display: none;">
      <h2 id="register-heading">×”×¨×©××”</h2>
      <input type="text" id="reg-username" placeholder="×©× ××©×ª××©" aria-label="Username">
      <input type="password" id="reg-password" placeholder="×¡×™×¡××”" aria-label="Password">
      <input type="password" id="reg-confirm-password" placeholder="××™××•×ª ×¡×™×¡××”" aria-label="Confirm Password">
      <button onclick="register()">×”×¨×©××”</button>
    </div>
    <div id="login-form" style="display: none;">
      <h2 id="login-heading">×”×ª×—×‘×¨×•×ª</h2>
      <input type="text" id="login-username" placeholder="×©× ××©×ª××©" aria-label="Username">
      <input type="password" id="login-password" placeholder="×¡×™×¡××”" aria-label="Password">
      <button onclick="login()">×”×ª×—×‘×¨</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <img id="profile-pic" src="" alt="Profile Picture" style="width:50px; height:50px; border-radius:50%;">
      <h2 id="current-user"></h2>
      <button onclick="showSection('schedule')"><i class="fas fa-calendar-alt"></i> ××¢×¨×›×ª ×©×¢×•×ª</button>
      <button onclick="showSection('grades')"><i class="fas fa-chart-line"></i> ×¦×™×•× ×™×</button>
      <button onclick="showSection('assignments')"><i class="fas fa-tasks"></i> ××©×™××•×ª</button>
      <button onclick="showSection('resources')"><i class="fas fa-book"></i> ×¡×¤×¨×™×™×ª ××©××‘×™×</button>
      <button onclick="showSection('exams')"><i class="fas fa-pencil-alt"></i> × ×™×”×•×œ ××‘×—× ×™×</button>
      <button onclick="showSection('schoolHours')"><i class="fas fa-clock"></i> ××¢×¨×›×ª ×©×¢×•×ª ×œ×™××•×“×™×</button>
      <button onclick="showSection('calendar-section')"><i class="fas fa-calendar-days"></i> ×œ×•×— ×©× ×”</button>
      <button onclick="toggleDarkMode()"><i class="fas fa-moon"></i> ××¦×‘ ×œ×™×œ×”</button>
    </nav>
    <!-- Main Content -->
    <div class="main-content">
      <header>
        <div>
          <h1 id="dashboard-greeting">×©×œ×•×, <span id="dashboard-username"></span>!</h1>
          <div id="clock"></div>
        </div>
        <div class="controls">
          <button id="btn-logout" onclick="logout()">ğŸšª ×™×¦×™××”</button>
          <button id="btn-dark-mode" onclick="toggleDarkMode()">ğŸŒ™ ××¦×‘ ×œ×™×œ×”</button>
          <button id="btn-settings" onclick="toggleSettings()">âš™ï¸ ×”×’×“×¨×•×ª</button>
          <button id="btn-profile" onclick="toggleProfile()">ğŸ‘¤ ×¤×¨×•×¤×™×œ</button>
          <button id="btn-help" onclick="toggleHelp()">â“ ×¢×–×¨×”</button>
          <button id="btn-customize-dashboard" onclick="toggleDashboardCustomization()"><i class="fas fa-th"></i> ×”×ª×××” ××™×©×™×ª</button>
        </div>
      </header>

      <!-- Weather Section -->
      <div class="card weather-section" id="weather">
        <h2><i class="fas fa-cloud-sun"></i> ××–×’ ××•×•×™×¨ ×•×”××œ×¦×•×ª ×œ×‘×•×©</h2>
        <select id="city-select" onchange="getWeather(this.value)">
          <option value="">×‘×—×¨ ×¢×™×¨</option>
          <option value="Tel Aviv">×ª×œ ××‘×™×‘</option>
          <option value="Jerusalem">×™×¨×•×©×œ×™×</option>
          <option value="Haifa">×—×™×¤×”</option>
          <option value="Beer Sheva">×‘××¨ ×©×‘×¢</option>
          <option value="Eilat">××™×œ×ª</option>
        </select>
        <div id="weather-info"></div>
        <div class="bag-items" id="clothing-recommendations"></div>
        <div class="bag-items" id="bag-recommendations"></div>
      </div>

      <!-- Schedule Management Section -->
      <div class="card" id="schedule">
        <h2 id="schedule-heading">ğŸ“… × ×™×”×•×œ ××¢×¨×›×ª ×©×¢×•×ª</h2>
        <input type="text" id="search-input" placeholder="×—×¤×© × ×•×©×..." aria-label="Search Subject">
        <select id="category-filter" onchange="filterByCategory(this.value)">
          <option value="all">×”×›×œ</option>
          <option value="××ª××˜×™×§×”">××ª××˜×™×§×”</option>
          <option value="××“×¢×™×">××“×¢×™×</option>
          <option value="×”×™×¡×˜×•×¨×™×”">×”×™×¡×˜×•×¨×™×”</option>
          <option value="×›×œ×œ×™">×›×œ×œ×™</option>
        </select>
        <div id="progress-container">
          <div id="progress-bar"></div>
        </div>
        <div id="days-container"></div>
      </div>

      <!-- Calendar View Section -->
      <div class="card" id="calendar-section">
        <h2><i class="fas fa-calendar-days"></i> ×œ×•×— ×©× ×”</h2>
        <div class="calendar-view" id="calendar"></div>
      </div>

      <!-- School Hours System Section -->
      <div class="card school-hours" id="schoolHours">
        <h2>××¢×¨×›×ª ×©×¢×•×ª ×œ×™××•×“×™×</h2>
        <div id="school-hours-table"></div>
        <div class="form-group">
          <select id="school-hours-day">
            <option value="×¨××©×•×Ÿ">×¨××©×•×Ÿ</option>
            <option value="×©× ×™">×©× ×™</option>
            <option value="×©×œ×™×©×™">×©×œ×™×©×™</option>
            <option value="×¨×‘×™×¢×™">×¨×‘×™×¢×™</option>
            <option value="×—××™×©×™">×—××™×©×™</option>
            <option value="×©×™×©×™">×©×™×©×™</option>
          </select>
          <select id="school-hours-time">
            <option value="08:00-09:00">08:00-09:00</option>
            <option value="09:00-10:00">09:00-10:00</option>
            <option value="10:00-11:00">10:00-11:00</option>
            <option value="11:00-12:00">11:00-12:00</option>
            <option value="12:00-13:00">12:00-13:00</option>
            <option value="13:00-14:00">13:00-14:00</option>
          </select>
          <input type="text" id="school-hours-subject" placeholder="× ×•×©×">
          <button onclick="addSchoolHour()">×”×•×¡×£ ×©×™×¢×•×¨</button>
        </div>
      </div>

      <!-- Assignments Section -->
      <div class="card" id="assignments">
        <h2>××©×™××•×ª ×•××•×¢×“×™ ×”×’×©×”</h2>
        <input type="text" id="assignment-title" placeholder="×›×•×ª×¨×ª ×”××©×™××”">
        <input type="date" id="assignment-due">
        <textarea id="assignment-desc" placeholder="×ª×™××•×¨ ×”××©×™××”"></textarea>
        <button onclick="addAssignment()">×”×•×¡×£ ××©×™××”</button>
        <div id="assignments-list"></div>
      </div>

      <!-- Grades Section -->
      <div class="card" id="grades">
        <h2>××¢×§×‘ ×¦×™×•× ×™×</h2>
        <input type="text" id="grade-subject" placeholder="× ×•×©×">
        <input type="number" id="grade-value" placeholder="×¦×™×•×Ÿ">
        <button onclick="addGrade()">×”×•×¡×£ ×¦×™×•×Ÿ</button>
        <canvas id="gradesChart" style="max-width:100%;"></canvas>
        <div id="grades-list"></div>
      </div>

      <!-- Resource Library Section (New Feature) -->
      <div class="card" id="resources">
        <h2>×¡×¤×¨×™×™×ª ××©××‘×™×</h2>
        <input type="text" id="resource-title" placeholder="×›×•×ª×¨×ª ×”××©××‘">
        <input type="text" id="resource-link" placeholder="×§×™×©×•×¨ ××• ×ª×™××•×¨ ×§×¦×¨">
        <button onclick="addResource()">×”×•×¡×£ ××©××‘</button>
        <div id="resources-list"></div>
      </div>

      <!-- Exam Management Section (New Feature) -->
      <div class="card" id="exams">
        <h2>× ×™×”×•×œ ××‘×—× ×™×</h2>
        <input type="text" id="exam-title" placeholder="×›×•×ª×¨×ª ×”××‘×—×Ÿ">
        <input type="date" id="exam-date">
        <textarea id="exam-desc" placeholder="×ª×™××•×¨ ×”××‘×—×Ÿ"></textarea>
        <button onclick="addExam()">×”×•×¡×£ ××‘×—×Ÿ</button>
        <div id="exams-list"></div>
      </div>

      <!-- Export, Data & Feedback Options -->
      <div class="export-options" id="export">
        <button id="btn-export-schedule" onclick="exportSchedule()">ğŸ“¤ ×™×™×¦×•× ××¢×¨×›×ª ×©×¢×•×ª</button>
        <button id="btn-export-pdf" onclick="exportToPDF()">ğŸ“„ ×™×™×¦×•× ×œ-PDF</button>
        <button id="btn-export-csv" onclick="exportScheduleCSV()">ğŸ“‘ ×™×™×¦×•× ×›-CSV</button>
        <button id="btn-export-excel" onclick="exportScheduleExcel()">ğŸ“Š ×™×™×¦×•× ×œ-Excel</button>
        <button id="btn-import-schedule" onclick="importSchedule()">ğŸ“¥ ×™×‘×•× ××¢×¨×›×ª ×©×¢×•×ª</button>
        <button id="btn-backup-cloud" onclick="backupToCloud()">â˜ï¸ ×’×™×‘×•×™ ×œ×¢× ×Ÿ</button>
        <button id="btn-restore-cloud" onclick="restoreFromCloud()">â™»ï¸ ×©×—×–×•×¨ ××’×™×‘×•×™</button>
        <button id="btn-print-schedule" onclick="printSchedule()">ğŸ–¨ï¸ ×”×“×¤×¡ ××¢×¨×›×ª ×©×¢×•×ª</button>
        <button id="btn-speech" onclick="startSpeechRecognition()">ğŸ¤ ×”×•×¡×¤×ª ×§×•×œ×™</button>
        <button id="btn-reset-data" onclick="resetData()">â™»ï¸ ××¤×¡ × ×ª×•× ×™×</button>
        <button id="btn-feedback" onclick="toggleFeedback()">ğŸ’¬ ××©×•×‘</button>
        <select id="theme-select" onchange="setCustomTheme(this.value)">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="blue">Blue</option>
          <option value="green">Green</option>
          <option value="red">Red</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Modals and Overlay -->
  <div class="modal" id="subject-modal">
    <h3>×¢×¨×™×›×ª × ×•×©×</h3>
    <input type="text" id="edit-subject-input" placeholder="×¢×¨×•×š × ×•×©×">
    <input type="text" id="edit-time-input" placeholder="×©×¢×” (×œ×“×•×’××”: 08:00-09:00)">
    <select id="edit-category-input">
      <option value="×›×œ×œ×™">×›×œ×œ×™</option>
      <option value="××ª××˜×™×§×”">××ª××˜×™×§×”</option>
      <option value="××“×¢×™×">××“×¢×™×</option>
      <option value="×”×™×¡×˜×•×¨×™×”">×”×™×¡×˜×•×¨×™×”</option>
    </select>
    <button onclick="saveEditedSubject()">×©××•×¨ ×©×™× ×•×™×™×</button>
  </div>
  <div class="overlay" id="modal-overlay"></div>

  <div class="settings-modal" id="settings-modal">
    <h3>×”×’×“×¨×•×ª ××ª×§×“××•×ª</h3>
    <label for="font-select">×‘×—×¨ ×’×•×¤×Ÿ:</label>
    <select id="font-select" onchange="changeFont(this.value)">
      <option value="Roboto">Roboto</option>
      <option value="Arial">Arial</option>
      <option value="Verdana">Verdana</option>
      <option value="Tahoma">Tahoma</option>
      <option value="Times New Roman">Times New Roman</option>
    </select>
    <button onclick="resetSettings()">××¤×¡ ×”×’×“×¨×•×ª</button>
    <button onclick="alert('×ª×›×•× ×” ×–×• ×ª×¦× ×‘×”××©×š')">×”×¢×“×¤×•×ª ×”×ª×¨××•×ª</button>
    <button onclick="alert('×ª×›×•× ×” ×–×• ×ª×¦× ×‘×”××©×š')">××¤×©×¨×•×™×•×ª ×¡× ×›×¨×•×Ÿ ××•×˜×•××˜×™</button>
    <button onclick="toggleSettings()">×¡×’×•×¨</button>
  </div>

  <div class="profile-modal" id="profile-modal">
    <h3>×¤×¨×•×¤×™×œ ××©×ª××©</h3>
    <label for="profile-username">×©× ××©×ª××©:</label>
    <input type="text" id="profile-username" disabled>
    <label for="profile-password">×¡×™×¡××” ×—×“×©×”:</label>
    <input type="password" id="profile-password">
    <label for="profile-pic-url">×§×™×©×•×¨ ×œ×ª××•× ×ª ×¤×¨×•×¤×™×œ:</label>
    <input type="text" id="profile-pic-url" placeholder="URL">
    <button onclick="updateProfile()">×¢×“×›×Ÿ ×¤×¨×•×¤×™×œ</button>
    <button onclick="toggleProfile()">×¡×’×•×¨</button>
  </div>

  <div class="help-modal" id="help-modal">
    <h3>×¢×–×¨×”</h3>
    <p>×‘×¨×•×›×™× ×”×‘××™× ×œ××¢×¨×›×ª × ×™×”×•×œ ×”×œ×™××•×“×™×. ×›××Ÿ ×ª×•×›×œ×•:</p>
    <ul>
      <li>×œ×”×•×¡×™×£, ×œ×¢×¨×•×š ×•×œ×¡××Ÿ × ×•×©××™× ×›×”×•×©×œ××•.</li>
      <li>×œ×¢×§×•×‘ ××—×¨×™ ×”×ª×§×“××•×ª×›× ×‘×××¦×¢×•×ª ×¡×¨×’×œ ×”×ª×§×“××•×ª.</li>
      <li>×œ×”×©×ª××© ×‘×§×œ×˜ ×§×•×œ×™ ×œ×”×•×¡×¤×ª × ×•×©××™×.</li>
      <li>×œ×™×™×¦× ××ª ××¢×¨×›×ª ×”×©×¢×•×ª ×›-JSON, CSV, Excel ××• PDF.</li>
      <li>×œ×”×ª××™× ××™×©×™×ª ××ª ×”× ×•×©×, ×”×’×•×¤×Ÿ ×•×œ×•×— ×”××—×•×•× ×™×.</li>
      <li>×œ× ×”×œ ××ª ××¢×¨×›×ª ×”×©×¢×•×ª ×”×œ×™××•×“×™×ª â€“ ×§×‘×¢×• ×©×™×¢×•×¨×™× ×‘×–××Ÿ ××•×’×“×¨ ×œ×›×œ ×™×•×.</li>
      <li>×œ×¢×§×•×‘ ××—×¨×™ ××©×™××•×ª ×•××•×¢×“×™ ×”×’×©×”.</li>
      <li>×œ×¢×§×•×‘ ××—×¨×™ ×¦×™×•× ×™×.</li>
      <li>×œ×”×•×¡×™×£ ×•×œ× ×”×œ ××©××‘×™× ×œ×™××•×“×™×™× ×‘×¡×¤×¨×™×™×ª ×”××©××‘×™× (×ª×›×•× ×” ×—×“×©×”).</li>
      <li>×œ× ×”×œ ××‘×—× ×™× â€“ ×§×‘×¢×• ××•×¢×“×™ ××‘×—× ×™× ×•×”×›× ×™×¡×• ×ª×™××•×¨×™× (×ª×›×•× ×” ×—×“×©×”).</li>
      <li>×¢×œ ×¤×™ ××–×’ ×”××•×•×™×¨ â€“ ×™×•×¦×’×• ×”××œ×¦×•×ª ×œ×‘×•×©.</li>
      <li>×¢×œ ×¤×™ ××¢×¨×›×ª ×”×©×¢×•×ª ×©×œ ×”××—×¨ â€“ ×™×•×¦×’×• ×”××œ×¦×•×ª ×œ×ª×™×§ (××” ×œ×”×›× ×™×¡/×œ×”×•×¦×™×) ×›×“×™ ×œ×”×™×•×ª ××•×›×Ÿ ×œ×™×•× ×”×‘×.</li>
    </ul>
    <button onclick="toggleHelp()">×¡×’×•×¨</button>
  </div>

  <div class="feedback-modal" id="feedback-modal">
    <h3>××©×•×‘</h3>
    <textarea id="feedback-text" placeholder="×›×ª×‘×• ×›××Ÿ ××ª ×”××©×•×‘..."></textarea>
    <button onclick="submitFeedback()">×©×œ×—</button>
    <button onclick="toggleFeedback()">×¡×’×•×¨</button>
  </div>

  <!-- Dashboard Customization Modal -->
  <div class="dashboard-customization-modal" id="dashboard-customization-modal">
    <h3>×”×ª×××” ××™×©×™×ª ×©×œ ×œ×•×— ×”××—×•×•× ×™×</h3>
    <form id="dashboard-customization-form">
      <label><input type="checkbox" name="section" value="weather" checked> ××–×’ ××•×•×™×¨ ×•×”××œ×¦×•×ª ×œ×‘×•×©</label><br>
      <label><input type="checkbox" name="section" value="schedule" checked> ××¢×¨×›×ª ×©×¢×•×ª</label><br>
      <label><input type="checkbox" name="section" value="grades" checked> ×¦×™×•× ×™×</label><br>
      <label><input type="checkbox" name="section" value="assignments" checked> ××©×™××•×ª</label><br>
      <label><input type="checkbox" name="section" value="resources" checked> ×¡×¤×¨×™×™×ª ××©××‘×™×</label><br>
      <label><input type="checkbox" name="section" value="exams" checked> × ×™×”×•×œ ××‘×—× ×™×</label><br>
      <label><input type="checkbox" name="section" value="schoolHours" checked> ××¢×¨×›×ª ×©×¢×•×ª ×œ×™××•×“×™×</label><br>
      <label><input type="checkbox" name="section" value="calendar-section" checked> ×œ×•×— ×©× ×”</label><br>
      <button type="button" onclick="saveDashboardCustomization()">×©××•×¨</button>
    </form>
  </div>

  <!-- JavaScript: Combined & Enhanced Functionality -->
  <script>
    "use strict";
    /***************** Global Variables *****************/
    const daysOfWeek = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™'];
    const timeSlots = ["08:00-09:00", "09:00-10:00", "10:00-11:00", "11:00-12:00", "12:00-13:00", "13:00-14:00"];
    let currentUser = null;
    // ×¨×§ ×¢×‘×¨×™×ª â€“ ××™×Ÿ ×ª××™×›×” ×‘×× ×’×œ×™×ª
    let currentLang = 'he';
    const translations = {
      he: {
        authHeading: "ğŸ“ ××¢×¨×›×ª × ×™×”×•×œ ×œ×™××•×“×™× ××ª×§×“××ª",
        newRegistration: "ğŸ“ ×”×¨×©××” ×—×“×©×”",
        login: "ğŸ”‘ ×”×ª×—×‘×¨×•×ª",
        registerHeading: "×”×¨×©××”",
        loginHeading: "×”×ª×—×‘×¨×•×ª",
        usernamePlaceholder: "×©× ××©×ª××©",
        passwordPlaceholder: "×¡×™×¡××”",
        confirmPasswordPlaceholder: "××™××•×ª ×¡×™×¡××”",
        logout: "ğŸšª ×™×¦×™××”",
        darkMode: "ğŸŒ™ ××¦×‘ ×œ×™×œ×”",
        weatherHeading: "â›… ××–×’ ××•×•×™×¨ ×•×”××œ×¦×•×ª ×œ×‘×•×©",
        bagItemsHeading: "ğŸ’ ×¤×¨×™×˜×™× ×™×•××™×™× ×œ×ª×™×§",
        scheduleHeading: "ğŸ“… × ×™×”×•×œ ××¢×¨×›×ª ×©×¢×•×ª",
        addSubject: "×”×•×¡×£ × ×•×©×",
        sortSubjects: "××™×™×Ÿ × ×•×©××™×",
        clearDay: "× ×§×” ×™×•×",
        edit: "×¢×¨×•×š",
        addNote: "×”×•×¡×£ ×”×¢×¨×”",
        reminder: "×ª×–×›×•×¨×ª",
        exportSchedule: "ğŸ“¤ ×™×™×¦×•× ××¢×¨×›×ª ×©×¢×•×ª",
        exportToPDF: "ğŸ“„ ×™×™×¦×•× ×œ-PDF",
        importSchedule: "ğŸ“¥ ×™×‘×•× ××¢×¨×›×ª ×©×¢×•×ª",
        backupToCloud: "â˜ï¸ ×’×™×‘×•×™ ×œ×¢× ×Ÿ",
        restoreFromCloud: "â™»ï¸ ×©×—×–×•×¨ ××’×™×‘×•×™",
        lightMode: "××¦×‘ ×‘×”×™×¨",
        themeDark: "× ×•×©× ×›×”×”",
        searchPlaceholder: "×—×¤×© × ×•×©×...",
        assignmentsHeading: "××©×™××•×ª ×•××•×¢×“×™ ×”×’×©×”",
        gradeSubjectPlaceholder: "× ×•×©×",
        gradeValuePlaceholder: "×¦×™×•×Ÿ",
        gradesHeading: "××¢×§×‘ ×¦×™×•× ×™×",
        profilePicPlaceholder: "×§×™×©×•×¨ ×œ×ª××•× ×ª ×¤×¨×•×¤×™×œ"
      }
    };
    const themes = {
      light: { '--background-color': '#f0f8ff', '--primary-color': '#2c3e50', '--secondary-color': '#4CAF50' },
      dark: { '--background-color': '#1e1e1e', '--primary-color': '#f5f5f5', '--secondary-color': '#4CAF50' },
      blue: { '--background-color': '#e0f7fa', '--primary-color': '#01579b', '--secondary-color': '#0288d1' },
      green: { '--background-color': '#e8f5e9', '--primary-color': '#1b5e20', '--secondary-color': '#43a047' },
      red: { '--background-color': '#ffebee', '--primary-color': '#b71c1c', '--secondary-color': '#e53935' }
    };
    const clothingRecommendations = {
      he: { cold: '××¢×™×œ', warm: '×‘×’×“×™× ×§×¦×¨×™×', rain: '××˜×¨×™×”', cloudy: '×¡×•×•×“×¨', sunny: '×›×•×‘×¢ ×•××©×§×¤×™ ×©××©' }
    };
    let notifiedSlots = {};
    let notifiedAssignments = {};
    let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
    let grades = JSON.parse(localStorage.getItem('grades') || '[]');
    // New: Resource Library
    let resources = JSON.parse(localStorage.getItem('resources') || '[]');
    // New: Exam Management
    let exams = JSON.parse(localStorage.getItem('exams') || '[]');

    /***************** Dashboard Customization *****************/
    function loadDashboardCustomization() {
      const config = JSON.parse(localStorage.getItem('dashboardSections') || '{}');
      const defaultConfig = {
        weather: true,
        schedule: true,
        grades: true,
        assignments: true,
        resources: true,
        exams: true,
        schoolHours: true,
        "calendar-section": true
      };
      return Object.assign(defaultConfig, config);
    }
    function applyDashboardCustomization() {
      const config = loadDashboardCustomization();
      for (const section in config) {
        const el = document.getElementById(section);
        if (el) {
          el.style.display = config[section] ? "block" : "none";
        }
      }
    }
    function toggleDashboardCustomization() {
      const modal = document.getElementById('dashboard-customization-modal');
      modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
      document.getElementById('modal-overlay').style.display = modal.style.display;
      const config = loadDashboardCustomization();
      document.querySelectorAll('#dashboard-customization-form input[name="section"]').forEach(input => {
        input.checked = !!config[input.value];
      });
    }
    function saveDashboardCustomization() {
      const newConfig = {};
      document.querySelectorAll('#dashboard-customization-form input[name="section"]').forEach(input => {
        newConfig[input.value] = input.checked;
      });
      localStorage.setItem('dashboardSections', JSON.stringify(newConfig));
      applyDashboardCustomization();
      toggleDashboardCustomization();
      showMessage('×œ×•×— ×”××—×•×•× ×™× ×¢×•×“×›×Ÿ', 'success');
    }

    /***************** Utility & UI Update Functions *****************/
    function updateLanguage() {
      localStorage.setItem('currentLang', currentLang);
      document.getElementById('auth-heading').textContent = translations[currentLang].authHeading;
      document.getElementById('btn-new-registration').textContent = translations[currentLang].newRegistration;
      document.getElementById('btn-login').textContent = translations[currentLang].login;
      document.getElementById('register-heading').textContent = translations[currentLang].registerHeading;
      document.getElementById('login-heading').textContent = translations[currentLang].loginHeading;
      document.getElementById('reg-username').placeholder = translations[currentLang].usernamePlaceholder;
      document.getElementById('reg-password').placeholder = translations[currentLang].passwordPlaceholder;
      document.getElementById('reg-confirm-password').placeholder = translations[currentLang].confirmPasswordPlaceholder;
      document.getElementById('login-username').placeholder = translations[currentLang].usernamePlaceholder;
      document.getElementById('login-password').placeholder = translations[currentLang].passwordPlaceholder;
      document.getElementById('btn-logout').textContent = translations[currentLang].logout;
      document.getElementById('btn-dark-mode').textContent = translations[currentLang].darkMode;
      document.getElementById('schedule-heading').textContent = translations[currentLang].scheduleHeading;
      document.getElementById('search-input').placeholder = translations[currentLang].searchPlaceholder;
      renderScheduleUI();
    }
    /***************** Theme & Font Functions *****************/
    function setTheme(theme) {
      if (theme === 'dark') {
        document.body.classList.add('dark-mode');
      } else if (theme === 'light') {
        document.body.classList.remove('dark-mode');
      }
      localStorage.setItem('currentTheme', theme);
    }
    function setCustomTheme(themeName) {
      if (themes[themeName]) {
        Object.keys(themes[themeName]).forEach(key => {
          document.documentElement.style.setProperty(key, themes[themeName][key]);
        });
        localStorage.setItem('currentCustomTheme', themeName);
      }
    }
    function changeFont(fontName) {
      document.body.style.fontFamily = fontName + ", sans-serif";
      localStorage.setItem('currentFont', fontName);
    }
    function toggleDarkMode() {
      if (document.body.classList.contains('dark-mode')) {
        document.body.classList.remove('dark-mode');
        localStorage.setItem('currentTheme', 'light');
      } else {
        document.body.classList.add('dark-mode');
        localStorage.setItem('currentTheme', 'dark');
      }
    }
    /***************** Section Navigation *****************/
    function showSection(section) {
      const sectionElement = document.getElementById(section);
      if(sectionElement) {
        sectionElement.scrollIntoView({ behavior: "smooth" });
      } else {
        alert("×ª×›×•× ×” ×–×• ×ª×¦× ×‘×”××©×š");
      }
    }
    /***************** Notification & Message *****************/
    function showMessage(message, type) {
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = message;
      document.body.appendChild(msgDiv);
      setTimeout(() => msgDiv.remove(), 3000);
    }
    /***************** Authentication *****************/
    const users = JSON.parse(localStorage.getItem('schoolUsers') || '{}');
    function showAuthForm(formType) {
      document.getElementById('login-or-register').style.display = 'none';
      if (formType === 'register') {
        document.getElementById('register-form').style.display = 'block';
      } else {
        document.getElementById('login-form').style.display = 'block';
      }
    }
    function register() {
      const username = document.getElementById('reg-username').value.trim();
      const password = document.getElementById('reg-password').value;
      const confirmPassword = document.getElementById('reg-confirm-password').value;
      if (!username || !password || !confirmPassword) {
        showMessage('×›×œ ×”×©×“×•×ª × ×“×¨×©×™×', 'error');
        return;
      }
      if (password !== confirmPassword) {
        showMessage('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª', 'error');
        return;
      }
      if (users[username]) {
        showMessage('×©× ×”××©×ª××© ×›×‘×¨ ×§×™×™×', 'error');
        return;
      }
      users[username] = {
        password,
        schedule: Array.from({length: 6}, () => []),
        schoolHours: {},
        profilePic: ""
      };
      daysOfWeek.forEach(day => { users[username].schoolHours[day] = []; });
      updateStorage();
      showMessage('×”×¨×©××” ×”×¦×œ×™×—×”!', 'success');
      currentUser = username;
      document.getElementById('dashboard-username').textContent = currentUser;
      document.getElementById('current-user').textContent = currentUser;
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('dashboard').style.display = 'flex';
      renderScheduleUI();
      renderSchoolHours();
    }
    function login() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      if (!username || !password) {
        showMessage('×›×œ ×”×©×“×•×ª × ×“×¨×©×™×', 'error');
        return;
      }
      if (!users[username] || users[username].password !== password) {
        showMessage('×©× ××©×ª××© ××• ×¡×™×¡××” ×©×’×•×™×™×', 'error');
        return;
      }
      showMessage('×”×ª×—×‘×¨×•×ª ×”×¦×œ×™×—×”!', 'success');
      currentUser = username;
      document.getElementById('dashboard-username').textContent = currentUser;
      document.getElementById('current-user').textContent = currentUser;
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('dashboard').style.display = 'flex';
      renderScheduleUI();
      renderSchoolHours();
      renderAssignments();
      renderGrades();
      renderResources();
      renderExams();
    }
    function logout() {
      currentUser = null;
      showMessage('×”×ª× ×ª×§×ª ××”××¢×¨×›×ª', 'success');
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('auth-container').style.display = 'block';
    }
    function updateStorage() {
      localStorage.setItem('schoolUsers', JSON.stringify(users));
      if(currentUser) localStorage.setItem('currentUser', currentUser);
      localStorage.setItem('assignments', JSON.stringify(assignments));
      localStorage.setItem('grades', JSON.stringify(grades));
      localStorage.setItem('resources', JSON.stringify(resources));
      localStorage.setItem('exams', JSON.stringify(exams));
    }
    /***************** Weather & Clothing Recommendations *****************/
    async function getWeather(city) {
      if (!city) return;
      try {
        const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=bfba7f78869e4222b89154845251302&q=${city}&aqi=no`);
        if (!response.ok) throw new Error("API error");
        const data = await response.json();
        const weatherInfo = `
          <p>×˜××¤×¨×˜×•×¨×”: ${data.current.temp_c}Â°C</p>
          <p>×ª× ××™×: ${data.current.condition.text}</p>
        `;
        document.getElementById('weather-info').innerHTML = weatherInfo;
        showClothingRecommendations(data.current);
      } catch (error) {
        showMessage('×©×’×™××” ×‘×§×‘×œ×ª × ×ª×•× ×™ ××–×’ ××•×•×™×¨', 'error');
        console.error("Error fetching weather:", error);
      }
    }
    function showClothingRecommendations(weather) {
      const recs = [];
      if (weather.temp_c < 15) recs.push(clothingRecommendations[currentLang].cold);
      if (weather.temp_c > 25) recs.push(clothingRecommendations[currentLang].warm);
      if (weather.precip_mm > 0) recs.push(clothingRecommendations[currentLang].rain);
      if (weather.cloud > 50) recs.push(clothingRecommendations[currentLang].cloudy);
      if (weather.condition.text.includes('×©××©') || weather.condition.text.includes('Sunny')) recs.push(clothingRecommendations[currentLang].sunny);
      document.getElementById('clothing-recommendations').innerHTML = `<strong>×”××œ×¦×•×ª ×œ×‘×•×©:</strong>
         <ul>${recs.map(item => `<li>${item}</li>`).join('')}</ul>`;
    }
    /***************** Bag Recommendations Based on Tomorrow's Schedule (New Feature) *****************/
    function updateBagRecommendations() {
      if (!currentUser || !users[currentUser].schedule) return;
      // × × ×™×— ×©××¢×¨×›×ª ×”×©×¢×•×ª ×××•×¨×’× ×ª ×¢×‘×•×¨ 6 ×™××™× (×¨××©×•×Ÿ-×©×™×©×™)
      let todayIndex = new Date().getDay();
      // ×× ×”×™×•× ×”×•× ×©×‘×ª (6) ××• ×©×™×©×™ (5) × × ×™×— ×©××—×¨ ×™×”×™×” ×¨××©×•×Ÿ (0)
      let tomorrowIndex = (todayIndex === 6 || todayIndex === 5) ? 0 : todayIndex + 1;
      let tomorrowSchedule = users[currentUser].schedule[tomorrowIndex] || [];
      let recommendations = [];
      if(tomorrowSchedule.length === 0) {
         recommendations.push("××™×Ÿ ×©×™×¢×•×¨×™× ×œ××—×¨");
      } else {
         recommendations.push("××—×‘×¨×ª", "×¢×˜", "×¢×™×¤×¨×•×Ÿ");
         tomorrowSchedule.forEach(subject => {
              if(subject.includes("××ª××˜×™×§×”") && !recommendations.includes("××—×©×‘×•×Ÿ")) {
                   recommendations.push("××—×©×‘×•×Ÿ");
              }
              if(subject.includes("××“×¢×™×") && !recommendations.includes("×¢×¨×›×ª × ×™×¡×•×™×™×")) {
                   recommendations.push("×¢×¨×›×ª × ×™×¡×•×™×™×");
              }
              if(subject.includes("×”×™×¡×˜×•×¨×™×”") && !recommendations.includes("×¡×¤×¨ ×”×™×¡×˜×•×¨×™×”")) {
                   recommendations.push("×¡×¤×¨ ×”×™×¡×˜×•×¨×™×”");
              }
         });
      }
      document.getElementById('bag-recommendations').innerHTML = `<strong>×”××œ×¦×•×ª ×œ×ª×™×§ ×œ××—×¨:</strong>
         <ul>${recommendations.map(item => `<li>${item}</li>`).join('')}</ul>`;
    }
    /***************** Schedule Management *****************/
    function renderScheduleUI() {
      const daysContainer = document.getElementById('days-container');
      daysContainer.innerHTML = '';
      if(!users[currentUser] || !users[currentUser].schedule) return;
      users[currentUser].schedule.forEach((subjects, index) => {
        let subjectHTML = subjects.map((subject, i) => `
          <div class="subject-card" data-index="${i}">
            <span onclick="toggleCompleted(this)">${subject}</span>
            <span class="remove-btn" title="Remove" onclick="removeSubject(${index}, '${subject}')">X</span>
            <button onclick="editSubject(${index}, '${subject}')" title="${translations[currentLang].edit}">${translations[currentLang].edit}</button>
            <button onclick="addNote(${index}, '${subject}')" title="${translations[currentLang].addNote}">${translations[currentLang].addNote}</button>
            <button onclick="setReminder(${index}, '${subject}')" title="${translations[currentLang].reminder}">${translations[currentLang].reminder}</button>
            <button onclick="markDone(this)" title="Mark as Completed">âœ”ï¸</button>
          </div>
        `).join('');
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day-container';
        dayDiv.innerHTML = `
          <h3>${daysOfWeek[index]}</h3>
          <input type="text" id="subject-input-${index}" placeholder="${translations[currentLang].addSubject}">
          <button onclick="addSubject(${index})" title="${translations[currentLang].addSubject}">${translations[currentLang].addSubject}</button>
          <button onclick="sortSubjects(${index})" title="${translations[currentLang].sortSubjects}">${translations[currentLang].sortSubjects}</button>
          <button onclick="clearDay(${index})" title="${translations[currentLang].clearDay}">${translations[currentLang].clearDay}</button>
          <div id="subjects-${index}">${subjectHTML}</div>
        `;
        daysContainer.appendChild(dayDiv);
      });
      bindSubjectEvents();
      updateProgress();
      updateBagRecommendations();
    }
    function addSubject(dayIndex) {
      const input = document.getElementById(`subject-input-${dayIndex}`);
      const subject = input.value.trim();
      if (!subject) {
        showMessage('×× × ×”×–×Ÿ × ×•×©×', 'error');
        return;
      }
      if (!users[currentUser].schedule) {
        users[currentUser].schedule = Array.from({length: 6}, () => []);
      }
      users[currentUser].schedule[dayIndex].push(subject);
      updateStorage();
      renderScheduleUI();
      input.value = '';
    }
    function removeSubject(dayIndex, subject) {
      users[currentUser].schedule[dayIndex] = users[currentUser].schedule[dayIndex].filter(s => s !== subject);
      updateStorage();
      renderScheduleUI();
    }
    function editSubject(dayIndex, subject) {
      document.getElementById('subject-modal').style.display = 'block';
      document.getElementById('modal-overlay').style.display = 'block';
      document.getElementById('edit-subject-input').value = subject;
      document.getElementById('edit-time-input').value = '08:00-09:00';
      document.getElementById('edit-category-input').value = '×›×œ×œ×™';
    }
    function saveEditedSubject() {
      document.getElementById('subject-modal').style.display = 'none';
      document.getElementById('modal-overlay').style.display = 'none';
      showMessage('×”× ×•×©× ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”', 'success');
      // (Optional: ×¢×“×›×•×Ÿ ×”××™×“×¢ ×‘××¢×¨×›×ª)
    }
    function sortSubjects(dayIndex) {
      users[currentUser].schedule[dayIndex].sort();
      updateStorage();
      renderScheduleUI();
    }
    function addNote(dayIndex, subject) {
      const note = prompt('×”×–×Ÿ ×”×¢×¨×” ×¢×‘×•×¨ ×”× ×•×©×:');
      if (note) {
        removeSubject(dayIndex, subject);
        users[currentUser].schedule[dayIndex].push(subject + ' (' + note + ')');
        updateStorage();
        renderScheduleUI();
      }
    }
    function setReminder(dayIndex, subject) {
      const reminderTime = prompt('×”×–×Ÿ ×–××Ÿ ×ª×–×›×•×¨×ª (×œ×“×•×’××”: 07:30):');
      if (reminderTime) {
        if (Notification.permission !== "granted") {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              new Notification('×ª×–×›×•×¨×ª', { body: subject + ' - ' + reminderTime });
            }
          });
        } else {
          new Notification('×ª×–×›×•×¨×ª', { body: subject + ' - ' + reminderTime });
        }
        showMessage('×ª×–×›×•×¨×ª ×¢×‘×•×¨ ' + subject + ' ×”×•×’×“×¨×” ×œ×©×¢×” ' + reminderTime, 'success');
      }
    }
    function clearDay(dayIndex) {
      if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”× ×•×©××™× ×©×œ ×”×™×•×?')) {
        users[currentUser].schedule[dayIndex] = [];
        updateStorage();
        renderScheduleUI();
        showMessage('×”× ×•×©××™× × ××—×§×•', 'success');
      }
    }
    /***************** Calendar & Export Functions *****************/
    function renderCalendar() {
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';
      const date = new Date();
      const currentDay = date.getDate();
      for (let i = 1; i <= 31; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.textContent = i;
        dayDiv.style.background = i === currentDay ? 'var(--secondary-color)' : '#fff';
        dayDiv.style.color = i === currentDay ? '#fff' : 'var(--primary-color)';
        dayDiv.addEventListener('click', () => alert('× ×‘×—×¨ ×”×™×•×: ' + i));
        calendar.appendChild(dayDiv);
      }
    }
    renderCalendar();
    function exportSchedule() {
      const dataStr = JSON.stringify(users[currentUser].schedule);
      const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', 'schedule.json');
      linkElement.click();
    }
    function exportScheduleCSV() {
      if (!users[currentUser] || !users[currentUser].schedule) return;
      let csvContent = "data:text/csv;charset=utf-8,";
      users[currentUser].schedule.forEach((subjects, index) => {
        csvContent += daysOfWeek[index] + "," + subjects.join(";") + "\n";
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "schedule.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    function exportScheduleExcel() {
      if (!users[currentUser] || !users[currentUser].schedule) return;
      let csvContent = "";
      users[currentUser].schedule.forEach((subjects, index) => {
        csvContent += daysOfWeek[index] + "\t" + subjects.join("\t") + "\n";
      });
      const blob = new Blob([csvContent], { type: "application/vnd.ms-excel" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "schedule.xls";
      a.click();
      URL.revokeObjectURL(url);
    }
    function importSchedule() {
      const inputElement = document.createElement('input');
      inputElement.type = 'file';
      inputElement.accept = 'application/json';
      inputElement.addEventListener('change', function(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            users[currentUser].schedule = JSON.parse(e.target.result);
            updateStorage();
            renderScheduleUI();
            showMessage('××¢×¨×›×ª ×”×©×¢×•×ª ×¢×•×“×›× ×”', 'success');
          } catch (error) {
            showMessage('×§×•×‘×¥ ×œ× ×—×•×§×™', 'error');
          }
        };
        reader.readAsText(file);
      });
      inputElement.click();
    }
    function exportToPDF() {
      showMessage('×™×™×¦×•× ×œ-PDF ×‘×”×§×“×', 'success');
    }
    function printSchedule() {
      window.print();
    }
    /***************** School Hours System *****************/
    function renderSchoolHours() {
      if (!currentUser || !users[currentUser].schoolHours) return;
      let html = '<table>';
      html += '<tr><th>×©×¢×”</th>';
      daysOfWeek.forEach(day => { html += `<th>${day}</th>`; });
      html += '</tr>';
      timeSlots.forEach(slot => {
        html += `<tr><td>${slot}</td>`;
        daysOfWeek.forEach(day => {
          const classes = users[currentUser].schoolHours[day] || [];
          const entry = classes.find(cls => cls.time === slot);
          if (entry) {
            html += `<td>${entry.subject} <button class="delete-hour" onclick="removeSchoolHour('${day}','${slot}')">X</button></td>`;
          } else {
            html += `<td></td>`;
          }
        });
        html += '</tr>';
      });
      html += '</table>';
      document.getElementById('school-hours-table').innerHTML = html;
    }
    function addSchoolHour() {
      const day = document.getElementById('school-hours-day').value;
      const time = document.getElementById('school-hours-time').value;
      const subject = document.getElementById('school-hours-subject').value.trim();
      if (!subject) {
        showMessage('×™×© ×œ×”×–×™×Ÿ × ×•×©×', 'error');
        return;
      }
      const daySchedule = users[currentUser].schoolHours[day];
      if (daySchedule.find(cls => cls.time === time)) {
        showMessage('×©×™×¢×•×¨ ×›×‘×¨ ×§×™×™× ×‘×©×¢×” ×–×•', 'error');
        return;
      }
      daySchedule.push({ time, subject });
      updateStorage();
      renderSchoolHours();
      document.getElementById('school-hours-subject').value = '';
      showMessage('×”×©×™×¢×•×¨ × ×•×¡×£', 'success');
    }
    function removeSchoolHour(day, time) {
      users[currentUser].schoolHours[day] = users[currentUser].schoolHours[day].filter(cls => cls.time !== time);
      updateStorage();
      renderSchoolHours();
      showMessage('×”×©×™×¢×•×¨ ×”×•×¡×¨', 'success');
    }
    /***************** Upcoming Class Notification *****************/
    function checkUpcomingClass() {
      if (!currentUser) return;
      const today = new Date();
      let dayIndex = today.getDay();
      if(dayIndex === 6) return;
      const todayName = daysOfWeek[dayIndex];
      const currentMinutes = today.getHours() * 60 + today.getMinutes();
      const slots = users[currentUser].schoolHours[todayName] || [];
      slots.forEach(slot => {
        let startTime = slot.time.split('-')[0];
        const [startHour, startMin] = startTime.split(':').map(Number);
        const slotMinutes = startHour * 60 + startMin;
        if (slotMinutes - currentMinutes <= 10 && slotMinutes - currentMinutes > 0) {
          const key = todayName + slot.time;
          if (!notifiedSlots[key]) {
            if (Notification.permission === "granted") {
              new Notification('×”×•×“×¢×ª ×©×™×¢×•×¨ ×§×¨×•×‘', { body: `${slot.subject} ×‘×©×¢×” ${slot.time}` });
              notifiedSlots[key] = true;
            }
          }
        }
      });
    }
    setInterval(checkUpcomingClass, 60000);
    /***************** Smart Assignment Reminders *****************/
    function checkAssignmentReminders() {
      if (!currentUser) return;
      const now = new Date();
      assignments.forEach((assignment, index) => {
        const due = new Date(assignment.dueDate);
        const diff = due - now;
        if (diff > 0 && diff <= 86400000 && !notifiedAssignments[index]) {
          if (Notification.permission === "granted") {
            new Notification('××©×™××” ×§×¨×•×‘×”', { body: `${assignment.title} - ${assignment.dueDate}` });
            notifiedAssignments[index] = true;
          }
        }
      });
    }
    setInterval(checkAssignmentReminders, 60000);
    /***************** Assignment Deadlines Tracker *****************/
    function addAssignment() {
      const title = document.getElementById('assignment-title').value.trim();
      const dueDate = document.getElementById('assignment-due').value;
      const desc = document.getElementById('assignment-desc').value.trim();
      if (!title || !dueDate) {
        showMessage('×™×© ×œ×”×–×™×Ÿ ×›×•×ª×¨×ª ×•××•×¢×“ ×”×’×©×”', 'error');
        return;
      }
      assignments.push({ title, dueDate, desc });
      updateStorage();
      renderAssignments();
      document.getElementById('assignment-title').value = '';
      document.getElementById('assignment-due').value = '';
      document.getElementById('assignment-desc').value = '';
      showMessage('××©×™××” × ×•×¡×¤×”', 'success');
    }
    function renderAssignments() {
      const container = document.getElementById('assignments-list');
      container.innerHTML = '';
      assignments.forEach((assignment, index) => {
        const due = new Date(assignment.dueDate);
        const now = new Date();
        let status = '';
        if (due - now < 86400000 && due - now > 0) {
          status = ' (×‘×¢×“×™×¤×•×ª - ×”×’×©×” ×ª×•×š 24 ×©×¢×•×ª)';
          if (Notification.permission === "granted") {
            new Notification('××©×™××” ×§×¨×•×‘×”', { body: assignment.title + ' - ' + assignment.dueDate });
          }
        }
        container.innerHTML += `<div>${assignment.title} - ${assignment.dueDate} ${status}</div>`;
      });
    }
    /***************** Grade Tracking *****************/
    function addGrade() {
      const subject = document.getElementById('grade-subject').value.trim();
      const gradeValue = document.getElementById('grade-value').value;
      if (!subject || !gradeValue) {
        showMessage('×™×© ×œ×”×–×™×Ÿ × ×•×©× ×•×¦×™×•×Ÿ', 'error');
        return;
      }
      grades.push({ subject, grade: Number(gradeValue) });
      updateStorage();
      renderGrades();
      document.getElementById('grade-subject').value = '';
      document.getElementById('grade-value').value = '';
      showMessage('×¦×™×•×Ÿ × ×•×¡×£', 'success');
      updateGradesChart();
    }
    function renderGrades() {
      const container = document.getElementById('grades-list');
      container.innerHTML = '';
      grades.forEach((g, index) => {
        container.innerHTML += `<div>${g.subject}: ${g.grade}</div>`;
      });
    }
    function updateGradesChart() {
      const ctx = document.getElementById('gradesChart').getContext('2d');
      const subjects = grades.map(g => g.subject);
      const gradeValues = grades.map(g => g.grade);
      if(window.gradesChartInstance) window.gradesChartInstance.destroy();
      window.gradesChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: subjects,
          datasets: [{
            label: translations[currentLang].gradesHeading,
            data: gradeValues,
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
          }]
        }
      });
    }
    /***************** Resource Library (New Feature) *****************/
    function addResource() {
      const title = document.getElementById('resource-title').value.trim();
      const link = document.getElementById('resource-link').value.trim();
      if (!title || !link) {
        showMessage('×™×© ×œ×”×–×™×Ÿ ×›×•×ª×¨×ª ×•×§×™×©×•×¨/×ª×™××•×¨', 'error');
        return;
      }
      resources.push({ title, link });
      localStorage.setItem('resources', JSON.stringify(resources));
      renderResources();
      document.getElementById('resource-title').value = '';
      document.getElementById('resource-link').value = '';
      showMessage('××©××‘ × ×•×¡×£', 'success');
    }
    function renderResources() {
      const container = document.getElementById('resources-list');
      container.innerHTML = '';
      resources.forEach((res, index) => {
        container.innerHTML += `<div>${res.title}: <a href="${res.link}" target="_blank">${res.link}</a></div>`;
      });
    }
    /***************** Exam Management (New Feature) *****************/
    function addExam() {
      const title = document.getElementById('exam-title').value.trim();
      const examDate = document.getElementById('exam-date').value;
      const desc = document.getElementById('exam-desc').value.trim();
      if (!title || !examDate) {
        showMessage('×™×© ×œ×”×–×™×Ÿ ×›×•×ª×¨×ª ×•×ª××¨×™×š', 'error');
        return;
      }
      exams.push({ title, examDate, desc });
      localStorage.setItem('exams', JSON.stringify(exams));
      renderExams();
      document.getElementById('exam-title').value = '';
      document.getElementById('exam-date').value = '';
      document.getElementById('exam-desc').value = '';
      showMessage('××‘×—×Ÿ × ×•×¡×£', 'success');
    }
    function renderExams() {
      const container = document.getElementById('exams-list');
      container.innerHTML = '';
      exams.forEach((exam, index) => {
        container.innerHTML += `<div>${exam.title} - ${exam.examDate} <br><small>${exam.desc}</small></div>`;
      });
    }
    /***************** Auto-Save Functionality *****************/
    function autoSaveData() {
      updateStorage();
      showMessage('× ×ª×•× ×™× × ×©××¨×• ××•×˜×•××˜×™×ª', 'success');
    }
    setInterval(autoSaveData, 60000);
    /***************** Voice Input *****************/
    function startSpeechRecognition() {
      if (!('webkitSpeechRecognition' in window)) {
        showMessage('×“×™×‘×•×¨ ×œ× × ×ª××š ×‘×“×¤×“×¤×Ÿ ×–×”', 'error');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'he-IL';
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        if (currentUser && users[currentUser].schedule) {
          users[currentUser].schedule[0].push(transcript);
          updateStorage();
          renderScheduleUI();
          showMessage('× ×•×©× × ×•×¡×£ ×‘×××¦×¢×•×ª ×§×•×œ: ' + transcript, 'success');
        }
      };
      recognition.onerror = function(event) {
        showMessage('×©×’×™××” ×‘×”×›×¨×” ×§×•×œ×™×ª', 'error');
      };
      recognition.start();
    }
    /***************** Modal Toggles *****************/
    function toggleSettings() {
      const modal = document.getElementById('settings-modal');
      modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
    }
    function toggleProfile() {
      const modal = document.getElementById('profile-modal');
      modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
      if (currentUser) {
        document.getElementById('profile-username').value = currentUser;
        document.getElementById('profile-pic-url').value = users[currentUser].profilePic || '';
      }
    }
    function toggleHelp() {
      const modal = document.getElementById('help-modal');
      modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
    }
    function toggleFeedback() {
      const modal = document.getElementById('feedback-modal');
      modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
    }
    function submitFeedback() {
      const feedback = document.getElementById('feedback-text').value.trim();
      if(feedback) {
        showMessage('×ª×•×“×” ×¢×œ ×”××©×•×‘!', 'success');
        document.getElementById('feedback-text').value = '';
        toggleFeedback();
      } else {
        showMessage('×™×© ×œ×”×–×™×Ÿ ××©×•×‘', 'error');
      }
    }
    function resetSettings() {
      localStorage.removeItem('currentLang');
      localStorage.removeItem('currentTheme');
      localStorage.removeItem('currentCustomTheme');
      localStorage.removeItem('currentFont');
      currentLang = 'he';
      setTheme('light');
      setCustomTheme('light');
      changeFont('Roboto');
      updateLanguage();
      toggleSettings();
      showMessage('×”×’×“×¨×•×ª ××•×¤×¡×•', 'success');
    }
    function resetData() {
      if(confirm("×”×× ×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×?")) {
        localStorage.clear();
        location.reload();
      }
    }
    /***************** Clock *****************/
    function updateClock() {
      document.getElementById('clock').textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    /***************** Auto-Login & Persistent Settings *****************/
    document.addEventListener('DOMContentLoaded', () => {
      // ×× ××™×Ÿ ××©×ª××© ××—×•×‘×¨, × ×‘×¦×¢ ×›× ×™×¡×” ××•×˜×•××˜×™×ª ×œ××©×ª××© demo
      if(!localStorage.getItem('currentUser')) {
        currentUser = "demo";
        if(!users["demo"]) {
          users["demo"] = {
            password: "demo",
            schedule: Array.from({length: 6}, () => []),
            schoolHours: {}
          };
          daysOfWeek.forEach(day => { users["demo"].schoolHours[day] = []; });
          updateStorage();
        }
      } else {
        currentUser = localStorage.getItem('currentUser');
      }
      const savedTheme = localStorage.getItem('currentTheme') || 'light';
      setTheme(savedTheme);
      const savedCustomTheme = localStorage.getItem('currentCustomTheme') || 'light';
      setCustomTheme(savedCustomTheme);
      const savedFont = localStorage.getItem('currentFont') || 'Roboto';
      changeFont(savedFont);
      updateLanguage();
      renderScheduleUI();
      renderCalendar();
      renderSchoolHours();
      renderAssignments();
      renderGrades();
      renderResources();
      renderExams();
      applyDashboardCustomization();
      // ×× ×”××©×ª××© demo, × ×¢×‘×™×¨ ××•×ª×• ×™×©×™×¨×•×ª ×œ×œ×•×— ×”××—×•×•× ×™×
      if (users[currentUser]) {
        document.getElementById('dashboard-username').textContent = currentUser;
        document.getElementById('current-user').textContent = currentUser;
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('dashboard').style.display = 'flex';
      }
    });
    window.addEventListener('beforeunload', () => {
      if (currentUser) localStorage.setItem('currentUser', currentUser);
    });
    // ×”×•×¡×¨ ×¨×™×©×•× service worker ×›×“×™ ×œ×× ×•×¢ ×‘×¢×™×•×ª ×‘×§×‘×¦×™× ××§×•××™×™×

  </script>

  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</body>
</html>
